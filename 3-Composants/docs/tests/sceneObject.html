<!DOCTYPE html>

<html>

<head>
  <title>
    Classe de test
  </title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>

<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
            <div id="jump_page_wrapper">
              <div id="jump_page">
                
                  
                    <a class="source" href="../components.html">
                      components.js
                    </a>
                    
                  
                    <a class="source" href="../graphicsAPI.html">
                      graphicsAPI.js
                    </a>
                    
                  
                    <a class="source" href="../inputAPI.html">
                      inputAPI.js
                    </a>
                    
                  
                    <a class="source" href="../main.html">
                      main.js
                    </a>
                    
                  
                    <a class="source" href="../pong.html">
                      pong.js
                    </a>
                    
                  
                    <a class="source" href="../scene.html">
                      scene.js
                    </a>
                    
                  
                    <a class="source" href="../sceneObject.html">
                      sceneObject.js
                    </a>
                    
                  
                    <a class="source" href="all.html">
                      tests/all.js
                    </a>
                    
                  
                    <a class="source" href="main.html">
                      tests/main.js
                    </a>
                    
                  
                    <a class="source" href="mockComponent.html">
                      tests/mockComponent.js
                    </a>
                    
                  
                    <a class="source" href="scene.html">
                      tests/scene.js
                    </a>
                    
                  
                    <a class="source" href="sceneObject.html">
                      tests/sceneObject.js
                    </a>
                    
                  
                    <a class="source" href="../utils.html">
                      utils.js
                    </a>
                    
              </div>
            </div>
        </li>
      </ul>
      
        <ul class="sections">
          
              
                
                  <li id="section-1">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-1">&#182;</a>
                        </div>
                        
                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>define([
  <span class="hljs-string">'chai'</span>,
  <span class="hljs-string">'components'</span>,
  <span class="hljs-string">'sceneObject'</span>,
  <span class="hljs-string">'scene'</span>,
], (
  chai,
  mockComponent,
  SceneObject,
  Scene
) =&gt; {
  <span class="hljs-string">'use strict'</span>;</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-2">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-2">&#182;</a>
                        </div>
                        <h1 id="classe-de-test">Classe de test</h1>
<p>Cette classe de test est utilisée avec <a href="https://mochajs.org/">Mocha</a>,
une infrastructure permettant d’effectuer des tests unitaires.</p>
<p>Les tests sont réalisés conjointement avec le module <a href="http://chaijs.com/">Chai</a>
qui fournit des fonctions simplifiant les assertions avec
les tests. On utilise ici les fonctions <a href="http://chaijs.com/api/bdd/">expect</a>
de Chai, par choix.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>
  <span class="hljs-keyword">const</span> expect = chai.expect;

  <span class="hljs-keyword">const</span> TestComponent = mockComponent.TestComponent;</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-3">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-3">&#182;</a>
                        </div>
                        <h1 id="tests-sur-la-classe-sceneobject-">Tests sur la classe <em>SceneObject</em></h1>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>  describe(<span class="hljs-string">'SceneObject'</span>, () =&gt; {</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-4">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-4">&#182;</a>
                        </div>
                        <h2 id="-beforeeach-"><em>beforeEach</em></h2>
<p>Cette méthode est exécutée par Mocha avant chaque test.
On l’utilise pour nettoyer les méthodes statique témoin
de la classe de composant de test.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    beforeEach(() =&gt; {
      TestComponent.onCreate = ( <span class="hljs-comment">/*comp*/</span> ) =&gt; {};
      TestComponent.onSetup = ( <span class="hljs-comment">/*comp, descr*/</span> ) =&gt; {};
      TestComponent.onDisplay = ( <span class="hljs-comment">/*comp, dT*/</span> ) =&gt; {};
      TestComponent.onUpdate = ( <span class="hljs-comment">/*comp, dT*/</span> ) =&gt; {};
    });</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-5">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-5">&#182;</a>
                        </div>
                        <h2 id="tests-unitaires">Tests unitaires</h2>
<p>On vérifie ici si on peut créer un objet simple, et si
l’objet créé est une instance de la classe d’objet.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    it(<span class="hljs-string">'le module peut être instancié'</span>, (done) =&gt; {
      <span class="hljs-keyword">const</span> sceneObj = <span class="hljs-keyword">new</span> SceneObject();
      expect(sceneObj).instanceof(SceneObject);
      done();
    });</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-6">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-6">&#182;</a>
                        </div>
                        <p>Une instance de la classe SceneObject devrait avoir
ces méthodes et fonctions. Ce test vérifie qu’elles
existent bel et bien, sans vérifier leur fonctionnement.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    it(<span class="hljs-string">'a les méthodes requises'</span>, (done) =&gt; {
      <span class="hljs-keyword">const</span> sceneObj = <span class="hljs-keyword">new</span> SceneObject();
      expect(sceneObj).respondTo(<span class="hljs-string">'addComponent'</span>);
      expect(sceneObj).respondTo(<span class="hljs-string">'getComponent'</span>);
      expect(sceneObj).respondTo(<span class="hljs-string">'addChild'</span>);
      expect(sceneObj).respondTo(<span class="hljs-string">'getChild'</span>);
      expect(sceneObj).respondTo(<span class="hljs-string">'findObjectInScene'</span>);
      expect(sceneObj).respondTo(<span class="hljs-string">'display'</span>);
      expect(sceneObj).respondTo(<span class="hljs-string">'update'</span>);
      done();
    });</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-7">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-7">&#182;</a>
                        </div>
                        <p>Ce test vérifie si on peut ajouter un composant à
l’objet, par la méthode <code>addComponent</code>. Cette méthode
devrait instancier un nouveau composant de test, et on
conclut donc le test dans la méthode statique appelée
par le constructeur.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    it(<span class="hljs-string">'peut ajouter un composant'</span>, (done) =&gt; {
      <span class="hljs-keyword">const</span> sceneObj = <span class="hljs-keyword">new</span> SceneObject();

      TestComponent.onCreate = (comp) =&gt; {
        expect(comp.type).equals(<span class="hljs-string">'TestComp'</span>);
        expect(comp.owner).equals(sceneObj);
        done();
      };

      sceneObj.addComponent(<span class="hljs-string">'TestComp'</span>);
    });</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-8">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-8">&#182;</a>
                        </div>
                        <p>Ce test vérifie si on peut chercher un composant existant
à l’aide de la méthode <code>getComponent</code>. On ajoute deux
composants distincts à un objet, et on tente de les récupérer.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    it(<span class="hljs-string">'peut chercher un composant'</span>, (done) =&gt; {
      <span class="hljs-keyword">const</span> sceneObj = <span class="hljs-keyword">new</span> SceneObject();
      <span class="hljs-keyword">const</span> testComp = {};
      TestComponent.onCreate = (comp) =&gt; {
        testComp[comp.type] = comp;
      };

      sceneObj.addComponent(<span class="hljs-string">'TestComp'</span>);
      sceneObj.addComponent(<span class="hljs-string">'TestOtherComp'</span>);
      <span class="hljs-keyword">let</span> value = sceneObj.getComponent(<span class="hljs-string">'TestComp'</span>);
      expect(value).instanceof(TestComponent);
      expect(value).equals(testComp[<span class="hljs-string">'TestComp'</span>]);
      value = sceneObj.getComponent(<span class="hljs-string">'TestOtherComp'</span>);
      expect(value).instanceof(TestComponent);
      expect(value).equals(testComp[<span class="hljs-string">'TestOtherComp'</span>]);
      done();
    });</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-9">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-9">&#182;</a>
                        </div>
                        <p>On crée ici deux objets simples faisant office d’enfants
et on les ajoute à un objet par la méthode <code>addChild</code>.
On teste également la méthode <code>getChild</code> en vérifiant
si les objets récupérés sont ceux qui ont été ajoutés.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    it(<span class="hljs-string">'peut ajouter et chercher des enfants'</span>, (done) =&gt; {
      <span class="hljs-keyword">const</span> sceneObj = <span class="hljs-keyword">new</span> SceneObject();
      <span class="hljs-keyword">const</span> child1 = {
        hello: <span class="hljs-string">'world'</span>
      };
      <span class="hljs-keyword">const</span> child2 = {
        foo: <span class="hljs-string">'bar'</span>
      };
      sceneObj.addChild(<span class="hljs-string">'un'</span>, child1);
      sceneObj.addChild(<span class="hljs-string">'deux'</span>, child2);
      <span class="hljs-keyword">let</span> value = sceneObj.getChild(<span class="hljs-string">'un'</span>);
      expect(value).equals(child1);
      value = sceneObj.getChild(<span class="hljs-string">'deux'</span>);
      expect(value).equals(child2);
      done();
    });</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-10">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-10">&#182;</a>
                        </div>
                        <p>Ce test vérifie si il est possible de récupérer un objet
de la scène par la méthode <code>findObjectInScene</code>. On doit
tout d’abord créer une scène complète, pour ensuite tenter
de chercher l’objet. On compare avec la méthode <code>findObject</code>
de la classe <em>Scene</em> pour vérifier le bon fonctionnement.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    it(<span class="hljs-string">'peut chercher un objet globalement dans la scène'</span>, (done) =&gt; {
      Scene.create({
          premier: {
            components: {},
            children: {},
          },
          second: {
            components: {},
            children: {},
          },
        })
        .then((scene) =&gt; {
          <span class="hljs-keyword">const</span> obj1 = scene.findObject(<span class="hljs-string">'premier'</span>);
          <span class="hljs-keyword">const</span> reference = scene.findObject(<span class="hljs-string">'second'</span>);
          <span class="hljs-keyword">const</span> obj2 = obj1.findObjectInScene(<span class="hljs-string">'second'</span>);
          expect(obj2).exist;
          expect(obj2).instanceof(SceneObject);
          expect(obj2).equals(reference);
          done();
        })
        .catch((err) =&gt; {
          done(err || <span class="hljs-string">'Erreur inconnue'</span>);
        });
    });</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-11">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-11">&#182;</a>
                        </div>
                        <p>Lors de l’appel à la méthode <em>display</em>, l’objet doit à son
tour appeler la méthode <em>display</em> sur ses composants. On
vérifie que la méthode est appelée une seule fois.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    it(<span class="hljs-string">'appelle une fois la méthode "display" de ses composants'</span>, (done) =&gt; {
      <span class="hljs-keyword">const</span> sceneObj = <span class="hljs-keyword">new</span> SceneObject();
      <span class="hljs-keyword">const</span> calls = {};
      TestComponent.onDisplay = (comp, dT) =&gt; {
        expect(calls).not.property(comp.type);
        calls[comp.type] = dT;
      };

      sceneObj.addComponent(<span class="hljs-string">'TestComp'</span>);
      sceneObj.addComponent(<span class="hljs-string">'TestOtherComp'</span>);
      sceneObj.display(<span class="hljs-number">123</span>);
      expect(calls).property(<span class="hljs-string">'TestComp'</span>);
      expect(calls).property(<span class="hljs-string">'TestOtherComp'</span>);
      expect(calls.TestComp).equals(<span class="hljs-number">123</span>);
      expect(calls.TestOtherComp).equals(<span class="hljs-number">123</span>);
      done();
    });</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-12">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-12">&#182;</a>
                        </div>
                        <p>Comme pour le test ci-dessus, on vérifie que la méthode
<em>update</em> est appelée une seule fois sur tous les composants
de l’objet.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    it(<span class="hljs-string">'appelle une fois la méthode "update" de ses composants'</span>, (done) =&gt; {
      <span class="hljs-keyword">const</span> sceneObj = <span class="hljs-keyword">new</span> SceneObject();
      <span class="hljs-keyword">const</span> calls = {};
      TestComponent.onUpdate = (comp, dT) =&gt; {
        expect(calls).not.property(comp.type);
        calls[comp.type] = dT;
      };

      sceneObj.addComponent(<span class="hljs-string">'TestComp'</span>);
      sceneObj.addComponent(<span class="hljs-string">'TestOtherComp'</span>);
      sceneObj.update(<span class="hljs-number">123</span>);
      expect(calls).property(<span class="hljs-string">'TestComp'</span>);
      expect(calls).property(<span class="hljs-string">'TestOtherComp'</span>);
      expect(calls.TestComp).equals(<span class="hljs-number">123</span>);
      expect(calls.TestOtherComp).equals(<span class="hljs-number">123</span>);
      done();
    });
  });
});</pre></div>
                      </div>
                      
                  </li>
                  
        </ul>
        </div>
</body>

</html>
